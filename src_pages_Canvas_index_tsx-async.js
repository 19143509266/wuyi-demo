(("undefined"!=typeof globalThis?globalThis:self).makoChunk_global=("undefined"!=typeof globalThis?globalThis:self).makoChunk_global||[]).push([["src/pages/Canvas/index.tsx"],{"src/pages/Canvas/index.tsx":function(t,e,i){i.d(e,"__esModule",{value:!0}),i.e(e,{default:function(){return p;}});var n=i("@swc/helpers/_/_interop_require_default"),s=i("@swc/helpers/_/_interop_require_wildcard"),l=i("node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js"),r=i("node_modules/.pnpm/react@18.3.1/node_modules/react/index.js"),a=s._(r);class h{color;startX;startY;endX;endY;text;ctx;constructor(t,e,i,n){this.ctx=t,this.color=e,this.startX=i,this.startY=n,this.endX=i,this.endY=n,this.text="";}get MinX(){return Math.min(this.startX,this.endX);}get MaxX(){return Math.max(this.startX,this.endX);}get MinY(){return Math.min(this.startY,this.endY);}get MaxY(){return Math.max(this.startY,this.endY);}draw(t){let e=this.ctx;e.beginPath(),e.moveTo(this.MinX*t,this.MinY*t),e.lineTo(this.MaxX*t,this.MinY*t),e.lineTo(this.MaxX*t,this.MaxY*t),e.lineTo(this.MinX*t,this.MaxY*t),e.lineTo(this.MinX*t,this.MinY*t),e.fillStyle=this.color,e.fill(),e.lineCap="square",e.strokeStyle="#fff",e.lineWidth=3,e.stroke(),this.text&&(e.font="16px Arial",e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText(this.text,(this.MinX+this.MaxX)/2*t,(this.MinY+this.MaxY)/2*t));}isInside(t,e){return t>=this.MinX&&t<=this.MaxX&&e>=this.MinY&&e<=this.MaxY;}}class d{color;startX;startY;endX;endY;text;ctx;constructor(t,e,i,n){this.ctx=t,this.color=e,this.startX=i,this.startY=n,this.endX=i,this.endY=n,this.text="";}get MinX(){return Math.min(this.startX,this.endX);}get MaxX(){return Math.max(this.startX,this.endX);}get MinY(){return Math.min(this.startY,this.endY);}get MaxY(){return Math.max(this.startY,this.endY);}get centerX(){return(this.startX+this.endX)/2;}get centerY(){return(this.startY+this.endY)/2;}get radius(){let t=this.endX-this.startX,e=this.endY-this.startY;return Math.sqrt(t*t+e*e)/2;}draw(t){let e=this.ctx;e.beginPath(),e.arc(this.centerX*t,this.centerY*t,this.radius*t,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.lineCap="square",e.strokeStyle="#fff",e.lineWidth=3,e.stroke(),this.text&&(e.font="16px Arial",e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText(this.text,this.centerX*t,this.centerY*t));}isInside(t,e){let i=t-this.centerX,n=e-this.centerY;return Math.sqrt(i*i+n*n)<=this.radius;}}class o{color;startX;startY;endX;endY;text;ctx;constructor(t,e,i,n){this.ctx=t,this.color=e,this.startX=i,this.startY=n,this.endX=i,this.endY=n,this.text="";}get MinX(){return Math.min(this.startX,this.endX);}get MaxX(){return Math.max(this.startX,this.endX);}get MinY(){return Math.min(this.startY,this.endY);}get MaxY(){return Math.max(this.startY,this.endY);}get centerX(){return(this.startX+this.endX)/2;}get centerY(){return(this.startY+this.endY)/2;}get radiusX(){return Math.abs(this.endX-this.startX)/2;}get radiusY(){return Math.abs(this.endY-this.startY)/2;}draw(t){let e=this.ctx;e.beginPath(),e.ellipse(this.centerX*t,this.centerY*t,this.radiusX*t,this.radiusY*t,0,0,2*Math.PI),e.fillStyle=this.color,e.fill(),e.lineCap="square",e.strokeStyle="#fff",e.lineWidth=3,e.stroke(),this.text&&(e.font="16px Arial",e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText(this.text,this.centerX*t,this.centerY*t));}isInside(t,e){let i=(t-this.centerX)/this.radiusX,n=(e-this.centerY)/this.radiusY;return i*i+n*n<=1;}}var u=i("node_modules/.pnpm/antd@5.21.5_react-dom@18.3.1_react@18.3.1/node_modules/antd/es/radio/index.js"),c=n._(u),x=i("node_modules/.pnpm/antd@5.21.5_react-dom@18.3.1_react@18.3.1/node_modules/antd/es/color-picker/index.js"),f=n._(x),X=i("node_modules/.pnpm/antd@5.21.5_react-dom@18.3.1_react@18.3.1/node_modules/antd/es/space/index.js"),Y=n._(X),m=i("node_modules/.pnpm/antd@5.21.5_react-dom@18.3.1_react@18.3.1/node_modules/antd/es/input/index.js"),g=n._(m);let p=()=>{let t=(0,a.useRef)(null),e=(0,a.useRef)(null),[i,n]=(0,a.useState)("rect"),[s,r]=(0,a.useState)("#1677ff"),[u,x]=(0,a.useState)([]),[X,m]=(0,a.useState)(null),[p,M]=(0,a.useState)(null),_=(t,e)=>{for(let i=0;i<u.length;i++)if(u[i].isInside(t,e))return u[i];return null;};return(0,a.useEffect)(()=>{let n=t.current;if(!n)return;let l=n.getContext("2d");l&&(n.width=800*devicePixelRatio,n.height=500*devicePixelRatio,n.style.width="800px",n.style.height="500px",n.style.backgroundColor="#808080",n.onmousedown=function(t){let e=n.getBoundingClientRect(),r=t.clientX-e.left,a=t.clientY-e.top,u=_(r,a);if(u){let{startX:t,startY:i,endX:n,endY:s}=u;window.onmouseup=function(){window.onmousemove=null,window.onmouseup=null;},window.onmousemove=function(l){let h=l.clientX-e.left-r,d=l.clientY-e.top-a;u.startX=t+h,u.endX=n+h,u.startY=i+d,u.endY=s+d;};}else{let t=null;"rect"===i?t=new h(l,s,r,a):"round"===i?t=new d(l,s,r,a):"ellipse"===i&&(t=new o(l,s,r,a)),t&&x(e=>[...e,t]),window.onmouseup=function(){window.onmousemove=null,window.onmouseup=null;},window.onmousemove=function(i){let n=i.clientX-e.left,s=i.clientY-e.top;t&&(t.endX=n,t.endY=s);};}},n.ondblclick=function(t){let i=n.getBoundingClientRect(),s=_(t.clientX-i.left,t.clientY-i.top);s&&(m(s),M({x:t.clientX,y:t.clientY,text:s.text}),setTimeout(()=>{var t;null===(t=e.current)||void 0===t||t.focus();},0));});},[i,s,u]),(0,a.useEffect)(()=>{!function e(){let i=t.current;if(!i)return;let n=i.getContext("2d");n&&i&&(n.clearRect(0,0,i.width,i.height),u.forEach(t=>t.draw(devicePixelRatio)),requestAnimationFrame(e));}();},[u]),(0,l.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,l.jsxs)(Y.default,{style:{marginBottom:6},children:[(0,l.jsx)(f.default,{value:s,onChange:t=>{r(t.toRgbString());}}),(0,l.jsxs)(c.default.Group,{value:i,onChange:t=>n(t.target.value),children:[(0,l.jsx)(c.default,{value:"rect",children:"\u77E9\u5F62"}),(0,l.jsx)(c.default,{value:"ellipse",children:"\u692D\u5706"}),(0,l.jsx)(c.default,{value:"round",children:"\u5706"})]})]}),(0,l.jsx)("canvas",{ref:t}),p&&(0,l.jsx)(g.default,{ref:e,style:{position:"fixed",left:p.x,top:p.y,display:"block",width:200},defaultValue:p.text,onBlur:()=>{if(X){var t,i;X.text=(null===(i=e.current)||void 0===i?void 0:null===(t=i.input)||void 0===t?void 0:t.value)||"",M(null),m(null);}}})]});};}}]);
//# sourceMappingURL=src_pages_Canvas_index_tsx-async.js.map