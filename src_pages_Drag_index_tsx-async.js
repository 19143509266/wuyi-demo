(("undefined"!=typeof globalThis?globalThis:self).makoChunk_global=("undefined"!=typeof globalThis?globalThis:self).makoChunk_global||[]).push([["src/pages/Drag/index.tsx"],{"src/pages/Drag/index.tsx":function(e,t,i){i.d(t,"__esModule",{value:!0}),i.e(t,{default:function(){return _;}});var n=i("@swc/helpers/_/_interop_require_default"),l=i("@swc/helpers/_/_interop_require_wildcard"),s=i("node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js"),r=i("node_modules/.pnpm/react@18.3.1/node_modules/react/index.js"),o=l._(r),d={"handle-br":"handle-br-FPCyLFXZ","move-top":"move-top-84RxWb-F","handle-bm":"handle-bm-8ZBxED0p","panel-edit":"panel-edit-QXanYSqO","move-bottom":"move-bottom-gcluJZt5","handle-tm":"handle-tm-03Vu9wLG","handle-bl":"handle-bl-MWRg-3nx",outline:"outline-2up1cxIs","handle-tr":"handle-tr-f-OQfH4P","big-box":"big-box-IQDaZf3U",handle:"handle-jWjlXci3",shadow:"shadow-fhFUgMXu",slider:"slider-QZ55ldaJ",item:"item-azMQLrQV","handle-tl":"handle-tl-WVjysREz","handle-ml":"handle-ml-Ljn2uUtM","handle-mr":"handle-mr-wctDmcQV",move:"move-LvHYdgbl","move-left":"move-left-ns4wD4eV","move-right":"move-right-OlR4hbt3"};let a={x:36,y:18},u={width:1600,height:900},x=["tl","tm","tr","ml","mr","bl","bm","br"];var h=i("node_modules/.pnpm/uuid@10.0.0/node_modules/uuid/dist/esm-browser/v4.js"),m=n._(h);let y=(e,t,i)=>"x"===e?t*i.x/a.x*u.width:"y"===e?t*i.y/a.y*u.height:void 0,c=(e,t,i)=>"x"===e?t/i.x/u.width*a.x:"y"===e?t/i.y/u.height*a.y:0,v=(e,t)=>e.x<t.x+t.sizeX&&e.x+e.sizeX>t.x&&e.y<t.y+t.sizeY&&e.y+e.sizeY>t.y,w=(e,t)=>{let i=!1;return t(t=>{let n=b(t,e);return n.x=Math.min(Math.max(n.x,0),a.x-(n.sizeX||0)),n.y=Math.max(n.y,0),t.map(e=>{if(e.id!==n.id&&v(n,e)){i=!0;let t=e.y;return n.y<=e.y&&(t+=n.sizeY-e.y),{...e,y:t};}return e;});}),i;},p=(e,t,i)=>{t(t=>t.map(n=>{let l=n;return n.y>0&&(l=b(t,n)),n.id!==(null==e?void 0:e.id)||i?l:e;}));},b=(e,t)=>{let i=e.filter(e=>e.y<t.y&&e.x<t.x+t.sizeX&&e.x+e.sizeX>t.x&&e.id!==t.id).reduce((e,t)=>null===e||t.y>e.y?t:e,null);return i?i.x+i.sizeX<=t.x||t.x+t.sizeX<=i.x?{...t,y:i.y}:t.y<i.y+i.sizeY?{...t,y:t.y-i.sizeY}:{...t,y:i.y+i.sizeY}:{...t,y:0};},z=(e,t,i,n,l,s)=>{let r=(0,o.useRef)(e);r.current=e;let d=null;return{handleResizeMouseDown:(0,o.useCallback)((e,o)=>{var u,x,h,m;let y=e.clientX,v=e.clientY,z=(null===(u=r.current)||void 0===u?void 0:u.sizeX)||0,f=(null===(x=r.current)||void 0===x?void 0:x.sizeY)||0,g=(null===(h=r.current)||void 0===h?void 0:h.x)||0,M=(null===(m=r.current)||void 0===m?void 0:m.y)||0,X=e=>{var i,u,x,h;if(!r.current)return;let m=Math.round(c("x",e.clientX-y,l)),b=Math.round(c("y",e.clientY-v,l)),X=z,Y=f,j=g,_=M;switch(o){case"tl":X=z-m,Y=f-b,j=g+m,_=M+b;break;case"tm":Y=f-b,_=M+b;break;case"tr":X=z+m,Y=f-b,_=M+b;break;case"ml":X=z-m,j=g+m;break;case"mr":X=z+m;break;case"bl":X=z-m,Y=f+b,j=g+m;break;case"bm":Y=f+b;break;case"br":X=z+m,Y=f+b;}j+X>a.x&&(j=a.x-((null===(i=r.current)||void 0===i?void 0:i.sizeX)||0),X=(null===(u=r.current)||void 0===u?void 0:u.sizeX)||0),j<0&&(j=0,X=(null===(x=r.current)||void 0===x?void 0:x.sizeX)||0),_<0&&(_=0,Y=(null===(h=r.current)||void 0===h?void 0:h.sizeY)||0),s({...d={...r.current,sizeX:X,sizeY:Y,x:j,y:_},type:"drag"}),w(d,n)||(t(d),p(r.current,n,!1));},Y=()=>{if(s({x:0,y:0,sizeX:0,sizeY:0,type:"new"}),d){let e=b(i,d);e.x=Math.min(Math.max(e.x,0),a.x-(e.sizeX||0)),e.y=Math.max(e.y,0),t(e),n(t=>t.map(t=>t.id===(null==e?void 0:e.id)?e:t));}window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",Y);};window.addEventListener("mousemove",X),window.addEventListener("mouseup",Y);},[e,t,i,n,l])};},f=(e,t,i,n,l,s)=>{let r=(0,o.useRef)(e);r.current=e;let d=null;return{handleMoveMouseDown:(0,o.useCallback)(e=>{var o,u;let x=e.clientX,h=e.clientY,m=(null===(o=r.current)||void 0===o?void 0:o.x)||0,y=(null===(u=r.current)||void 0===u?void 0:u.y)||0,v=e=>{var i;if(!r.current)return;let o=Math.round(c("x",e.clientX-x,l)),u=Math.round(c("y",e.clientY-h,l)),v=m+o,b=y+u;v=Math.min(Math.max(v,0),a.x-((null===(i=r.current)||void 0===i?void 0:i.sizeX)||0)),b=Math.max(b,0),s({...d={...r.current,x:v,y:b},type:"drag"}),w(d,n)||(t(d),p(r.current,n,!1));},z=()=>{if(s({x:0,y:0,sizeX:0,sizeY:0,type:"new"}),d){let e=b(i,d);e.x=Math.min(Math.max(e.x,0),a.x-(e.sizeX||0)),e.y=Math.max(e.y,0),t(e),n(t=>t.map(t=>t.id===(null==e?void 0:e.id)?e:t));}window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",z);};window.addEventListener("mousemove",v),window.addEventListener("mouseup",z);},[e,t,i,n,l])};},g=(e,t,i,n)=>{let[l,s]=(0,o.useState)(0),[r,d]=(0,o.useState)(0),[x,h]=(0,o.useState)(1),[m,y]=(0,o.useState)(1);return(0,o.useEffect)(()=>{let l=u.width,r=u.height,o=Math.round((e-260)/(l/a.x)),x=Math.round(t/(r/a.y)),m=Math.round(i/l*a.x),c=Math.round(n/r*a.y);s(o),d(x),h(m),y(c);},[e,t,i,n]),{matrixX:l,matrixY:r,sizeX:x,sizeY:m};},M=e=>{let{setShadowPosition:t,setComponentData:i}=e,[n,l]=(0,o.useState)({x:0,y:0}),{matrixX:r,matrixY:x,sizeX:h,sizeY:y}=g(n.x,n.y,200,150),c=u.width/a.x,v=u.height/a.y,w=e=>{let i=e.clientX,n=e.clientY;i>0&&n>0&&l({x:i,y:n}),t({x:Math.round((i-260)/c),y:Math.round(n/v),sizeX:5,sizeY:3,type:"new"});},b=()=>{let e=n.x,t=n.y;if(e>260&&t>0){let e={id:(0,m.default)(),x:r,y:x,sizeX:h,sizeY:y};i(t=>[...t,e]),p(e,i,!0);}};return(0,s.jsx)("div",{className:d.slider,style:{width:260},children:Array.from({length:3}).map((e,t)=>(0,s.jsxs)("div",{className:d.item,draggable:!0,onDrag:w,onDragEnd:b,children:["item",t+1]},t))});},X=e=>{let{componentData:t,setComponentData:i,curComponent:n,setCurComponent:l,scale:r,setShadowPosition:o}=e,{handleResizeMouseDown:a}=z(n,l,t,i,r,o),{handleMoveMouseDown:u}=f(n,l,t,i,r,o),h=e=>{l(e);};return(0,s.jsx)("div",{style:{width:"100%",height:"100%",userSelect:"none"},children:t.map(e=>(0,s.jsxs)("div",{style:{width:y("x",e.sizeX,r),height:y("y",e.sizeY,r),background:"#fff000",transform:`translate(${y("x",e.x,r)}px, ${y("y",e.y,r)}px)`,position:"absolute",zIndex:999},onClick:()=>h(e),children:[e.id,n&&n.id===e.id?(0,s.jsxs)("div",{className:d.outline,children:[x.map(e=>(0,s.jsx)("div",{className:`${d.handle} ${d[`handle-${e}`]}`,onMouseDown:t=>a(t,e)},e)),["top","bottom","left","right"].map(e=>(0,s.jsx)("div",{className:`${d.move} ${d[`move-${e}`]}`,onMouseDown:e=>u(e)},e))]}):null]},e.id))});},Y=e=>{let{shadowPosition:t,scale:i,componentData:n}=e;if(t.x<0||t.y<0||0===t.x&&0===t.y)return null;let l=u.width/a.x,r=u.height/a.y,x=(0,o.useMemo)(()=>{let e=b(n,{id:"shadow",x:t.x,y:t.y,sizeX:t.sizeX,sizeY:t.sizeY});e.x=Math.min(Math.max(e.x,0),a.x-(e.sizeX||0)),e.y=Math.max(e.y,0);let s=e.x*l,o=e.y*r,d=e.sizeX*l,u=e.sizeY*r;return{transform:`translate(${s*i.x}px, ${o*i.y}px) rotate(0deg)`,width:d*i.x,height:u*i.y,transition:"0.1s",zIndex:10};},[t,l,r]);return(0,s.jsx)("div",{className:d.shadow,style:x});},j=({scale:e})=>{let t=(0,o.useRef)(null);return(0,o.useEffect)(()=>{let i=t.current;if(i){let t=i.getContext("2d");if(t){let{width:n,height:l}=u;i.width=n*e.x,i.height=l*e.y,t.strokeStyle="#e0e0e0",t.lineWidth=1;let s=n/a.x,r=l/a.y;for(let i=0;i<=a.x;i++)t.beginPath(),t.moveTo(i*s*e.x,0),t.lineTo(i*s*e.x,l*e.y),t.stroke();for(let i=0;i<=a.y;i++)t.beginPath(),t.moveTo(0,i*r*e.y),t.lineTo(n*e.x,i*r*e.y),t.stroke();}}},[e]),(0,s.jsx)("canvas",{ref:t,style:{backgroundColor:"#f0f0f0",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",border:"1px solid #d0d0d0",borderRadius:"4px",overflow:"hidden",position:"absolute",top:0,left:0,boxSizing:"border-box",zIndex:1}});},_=()=>{let[e,t]=(0,o.useState)([]),[i,n]=(0,o.useState)(null),[l,r]=(0,o.useState)({x:0,y:0,sizeX:5,sizeY:3,type:"new"}),[a,x]=(0,o.useState)({x:1,y:1});return(0,o.useEffect)(()=>{let e=()=>{let e=window.innerWidth-260,t=window.innerHeight;x({x:e/u.width,y:t/u.height});};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e);};},[]),(0,s.jsxs)("div",{className:d["big-box"],children:[(0,s.jsx)(M,{setShadowPosition:r,setComponentData:t}),(0,s.jsxs)("div",{className:d["panel-edit"],style:{width:"calc(100% - 260px)"},children:[(0,s.jsx)(Y,{shadowPosition:l,scale:a,componentData:e}),(0,s.jsx)(X,{componentData:e,setComponentData:t,curComponent:i,setCurComponent:n,scale:a,setShadowPosition:r}),(0,s.jsx)(j,{scale:a})]})]});};}}]);
//# sourceMappingURL=src_pages_Drag_index_tsx-async.js.map